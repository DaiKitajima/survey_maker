<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<!-- 共通Topインクルード -->
		<th:block th:replace="commonTop.html" />

		<script th:src="@{/js/surveyContentList.js}"></script>
		<title>診断コンテンツ詳細画面</title>
	</head>

	<body style="background: #EEEEEE;">
		<!-- 共通ナビヘッダー -->
		<th:block th:replace="commonNav.html" />

		<div class="container-fluid mb-5">
			<!-- タイトル -->
			<div class="row mt-3 mb-2">
				<div class="col-8">
					<span class="h5" th:text="|「${surveyContentDetailForm.surveyContent.surveyName}」コンテンツ詳細|"> 「高齢者健康調査」コンテンツ詳細</span>
				</div>
				<div class="col-4">
					<div class="d-flex justify-content-end">
						<a th:href="@{/surveyContentDetail/surveySimulation?contentId=__${surveyContentDetailForm.contentId}__}" class="btn btn-sm btn-success me-5" target="_blank">診断シミュレーション</a>
						<a th:href="@{/surveyContentDetail/surveyScriptCreate?contentId=__${surveyContentDetailForm.contentId}__}" class="btn btn-sm btn-success" target="_blank">埋め込みコード生成</a>
					</div>
				</div>

			</div>
			<th:block th:object="${surveyContentDetailForm}" >

				<!-- コンテンツ基本情報 START -->
				<div class="card shadow-lg mb-2">
					<div class="card-header bg-white">
						<div class="d-flex justify-content-between">
							<div>
								<span class="h6">基本情報</span>
							</div>
							<div>
								<a th:href="@{/surveyContentDetail/surveyContentUpdate?contentId=__*{contentId}__}" >
									<span class="h5 text-secondary"><i class="fa-solid fa-pen-to-square pe-2"></i></span>
								</a>
							</div>
						</div>

					</div>

					<div class="card-body">
						<div class="row">
							<div class="col-2">
								<span class="h6">コンテンツ名</span><br>
								<span th:text="*{surveyContent.surveyName}">高齢者健康調査</span>
							</div>
							<div class="col-2">
								<span class="h6">コンテンツパターン</span><br>
								<th:block th:each="pattern,stat: ${patternLst}" th:if="${pattern.id==__*{surveyContent.surveyPatternId}__}">
									<span th:text="${pattern.surveyPatternName}">単数</span>
								</th:block>
							</div>
							<div class="col-4">
								<span class="h6">コンテンツ画像</span><br>
								<a onclick="showimage('contentImg')" class="btn btn-default btn-xs active">
									<img id="contentImg" th:src="*{surveyContent.surveyImageBase64}" height="30" width="40" th:alt="*{surveyContent.surveyImage}" class="img-thumbnail">
								</a>
							</div>
							<div class="col-2">
								<span class="h6">コンテンツカラー</span>
								<input type="color" name="surveyColor" class="form-control form-control-color" th:value="*{surveyContent.surveyColor}" disabled/>
							</div>
						</div>
					</div>
				</div>
				<!-- コンテンツ基本情報 END -->

				<!-- 診断軸・質問タブ START -->
				<ul class="nav nav-tabs nav-pills">
					<li class="nav-item bg-white fw-bold text-center" style="width:200px;">
						<a href="#tabpanel1" class="nav-link active" data-bs-toggle="tab">
							診&nbsp;断&nbsp;軸&nbsp;([[__*{#lists.size(categoryLst)}__]])
						</a>
					</li>
					<li class="nav-item bg-white fw-bold text-center" style="width:200px;">
						<a href="#tabpanel2" class="nav-link" data-bs-toggle="tab">
							質問・回答&nbsp;([[__*{#lists.size(questionFormLst)}__]])
						</a>
					</li>
				</ul>
				<!-- 診断軸・質問タブ END -->

				<div class="tab-content">

					<!-- 診断軸 START -->
					<div id="tabpanel1" class="card shadow-lg tab-pane active">
						<div class="card-header bg-white">
							<div class="d-flex justify-content-between">
								<div>
									<span class="h6">診断軸</span>
								</div>
								<div>
									<div class="">
										<a th:href="@{/surveyContentDetail/surveyCategoryRegist?contentId=__*{contentId}__}" class="btn btn-sm btn-success">
											診断軸を追加する
										</a>
									</div>
								</div>
							</div>
						</div>
						<div class="card-body bg-light">

							<!-- 診断軸リスト START -->
							<div class="card mb-2" th:each="category,stat:*{categoryLst}">
								<div class="card-header bg-white">
									<div class="d-flex justify-content-between">
										<div>
											<span class="h6" th:text="${category.surveyCategoryName}">身体の調査</span>
										</div>
										<div>
											<div class="d-flex justify-content-end">
												<div>
													<a th:href="@{/surveyContentDetail/surveyCategoryUpdate?categoryId=__${category.id}__}" class="btn btn-sm btn-primary me-3" style="width:100px;">
														編集
													</a>
												</div>
												<div>
													<a th:href="@{/surveyContentDetail/surveyCategoryDelete?categoryId=__${category.id}__}" class="btn btn-sm btn-danger" style="width:100px;">
														削除
													</a>
												</div>
											</div>
										</div>
									</div>
								</div>

								<div class="card-body">

									<!-- 総合評価 START -->
									<div class="card mb-2">
										<div class="card-header bg-white">
											<span class="h6">総合評価</span>
										</div>
										<div class="card-body">
											<h6 th:text="|基準点数：${category.surveySummaryDecidePoint}点|">基準点数：50点</h6>

											<div class="row mt-3">
												<div class="col-6">
													<div class="card">
														<div class="card-header bg-white">
															<span class="h6">基準点数以上の評価</span>
														</div>
														<div class="card-body">
															<div class="row">
																<div class="col-12">
																	<div class="row">
																		<div class="col-3">
																			<span class="h6">タイトル</span>
																		</div>
																		<div class="col-9">
																			<span class="" th:text="${category.surveySummaryTitleAbove}">愛され自由人型</span>
																		</div>
																	</div>
																</div>
															</div>
															<div class="row">
																<div class="col-3">
																	<span class="h6">
																		評価内容
																	</span>
																</div>
																<div class="col-9">
																	<span class="dd" th:text="${category.surveySummaryDetailAbove}">
																		フレンドリーかつエネルギッシュに行動できる「愛され自由人型」です。 フレンドリーかつエネルギ・・・
																	</span>
																</div>
															</div>
															<div class="row">
																<div class="col-3">
																	<span class="h6">
																		画像
																	</span>
																</div>
																<div class="col-9">
																	<span class="">
																		<img id="contentImg3" th:src="${category.surveySummaryImageAboveBase64}" height="30" width="40" th:alt="${category.surveySummaryImageAbove}" class="img-thumbnail">
																	</span>
																</div>
															</div>
														</div>
													</div>
												</div>
												<div class="col-6">
													<div class="card">
														<div class="card-header bg-white">
															<span class="h6">基準点数未満の評価</span>
														</div>
														<div class="card-body">
															<div class="row">
																<div class="col-12">
																	<div class="row">
																		<div class="col-3">
																			<span class="h6">タイトル</span>
																		</div>
																		<div class="col-9">
																			<span class="" th:text="${category.surveySummaryTitleBelow}">愛され自由人型</span>
																		</div>
																	</div>
																</div>
															</div>
															<div class="row">
																<div class="col-3">
																	<span class="h6">
																		評価内容
																	</span>
																</div>
																<div class="col-9">
																	<span class="dd" th:text="${category.surveySummaryDetailBelow}">
																		フレンドリーかつエネルギッシュに行動できる「愛され自由人型」です。 フレンドリーかつエネルギ・・・
																	</span>
																</div>
															</div>
															<div class="row">
																<div class="col-3">
																	<span class="h6">
																		画像
																	</span>
																</div>
																<div class="col-9">
																	<span class="">
																		<img id="contentImg3" th:src="${category.surveySummaryImageBelowBase64}" height="30" width="40" th:alt="${category.surveySummaryImageBelow}" class="img-thumbnail">
																	</span>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>

										</div>
									</div>
									<!-- 総合評価 END -->

									<!-- 軸別診断結果 START -->
									<div class="card">
										<div class="card-header bg-white">
											<span class="h6">軸別診断結果</span>
										</div>
										<div class="card-body">
											<table class="table">
												<thead>
													<tr>
														<th>ポイント範囲</th>
														<th>タイトル</th>
														<th>評価内容</th>
														<th>画像</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="result,stat:${category.categoryContentLst}">
														<td class="align-middle">
															<span th:text="|${result.pointFrom} ～ ${result.pointTo}点|">
																80～100点
															</span>
														</td>
														<td class="align-middle">
															<span th:text="${result.surveyResult}">健康な身体を維持できています。</span>
														</td>
														<td class="align-middle">
															<span th:text="${result.surveyResultDetail}">
																エネルギーバランスがとれています。<br>
																エネルギーバランスがとれています。<br>
																エネルギーバランスがとれています。<br>
																エネルギーバランスがとれています。
															</span>
														</td>
														<td class="align-middle">
															<span>
																<img id="contentImg1" th:src="${result.surveyResultImgBase64}" height="30" width="40" th:alt="${result.surveyResultImage}" class="img-thumbnail">
															</span>
														</td>
													</tr>
												</tbody>

											</table>
										</div>
									</div>

									<!-- 診断軸別診断結果 END -->
								</div>
							</div>
						</div>
					</div>
					<div id="tabpanel2" class="card shadow-lg tab-pane">
						<!-- 質問コンテンツ -->
						<div class="card shadow-lg mb-2">
							<div class="card-body">
								<div class="row">
									<div class="col-2">
										<span class="h6">診断質問一覧</span>
									</div>
									<div class="col-6 d-flex justify-content-start ">
										<div>
											<a th:href="@{/surveyContentDetail/questionContentRegist?contentId=__*{contentId}__}" class="btn btn-sm btn-success me-1">質問登録</a>
											<a th:href="@{/surveyContentDetail/questionContentDelete?questionIdLst=1,2}" class="btn btn-sm btn-danger me-1">質問削除</a>
											<a th:href="@{/surveyContentDetail/questionLinkRegist?contentId=__*{contentId}__}" class="btn btn-sm btn-success me-1">リンク設定</a>
											<a th:href="@{/surveyContentDetail/questionLinkUpdate?contentId=__*{contentId}__}" class="btn btn-sm btn-primary me-1">リンク編集</a>
										</div>
									</div>
								</div>

								<div class="row container mb-2" style="border-bottom:1px dotted #000;padding:1px;">
									<div class="col d-flex justify-content-end">
										<a class="parent-nav" data-bs-toggle="collapse" href="#questionContent"></a>
									</div>
								</div>

								<!-- 質問コンテンツ一覧 -->
								<div id="questionContent" class="collapse child-nav show" >
									<table class="table table-bordered table-hover mt-2 mb-4">
										<thead class="table-secondary">
											<tr>
												<th class="align-middle" style="width:30px;" onclick="getElementById('checkAll').click();">
													<input type="checkbox" class="checkboxesStyle ml-2" id="checkAll" name="checkAll" value="1" onclick="this.click()">
												</th>
												<th class="align-middle" style="white-space: nowrap;">
													編集
												</th>
												<th class="align-middle" style="white-space: nowrap;">
													質問
												</th>
												<th class="align-middle" style="white-space: nowrap;">
													回答
												</th>
												<th class="align-middle" style="white-space: nowrap;">
													ポイント採点
												</th>
												<th class="align-middle" style="white-space: nowrap;">
													リンク
												</th>
												<th class="align-middle" style="white-space: nowrap;">
													質問画像
												</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="question,stat: *{questionFormLst}">
												<td class="align-middle" th:onclick="getElementById('recordData01').click();">
													<input type="checkbox" class="checkboxesStyle ml-2 checkItems" id="recordData01" th:value="${question.id}" onclick="this.click()">
												</td>
												<td class="align-middle text-center" style="white-space: nowrap;">
													<a th:href="@{/surveyContentDetail/questionContentUpdate?questionId=__${question.id}__}">
														<span class="text-secondary h5"><i class="bi bi-pencil-square"></i></span>
													</a>
												</td>
												<td class="align-middle text-left" style="white-space: nowrap;">
													<span th:text="|${stat.count}、${question.questionTitle}|"></span>
												</td>
												<td class="align-middle text-left" style="white-space: nowrap;">
													<ul>
														<li th:each="answer:${question.answerContentLst}">
															<span th:text="${answer.answer}"></span>
														</li>
													</ul>
												</td>
												<td class="align-middle text-left" style="white-space: nowrap;">
													<div th:each="answer,stat1:${question.answerContentLst}">
														<span class="h6" th:text="|回答${stat1.count}|"></span>
														<ul>
															<li th:each="category:*{categoryLst}">
																<th:block th:if="${answer.answerPointLst.^[categoryId==__${category.id}__]}">
																	<span th:text="|${category.surveyCategoryName}：${answer.answerPointLst.^[categoryId==__${category.id}__].point}|"></span>
																</th:block>
																<th:block th:unless="${answer.answerPointLst.^[categoryId==__${category.id}__]}">
																	<span th:text="|${category.surveyCategoryName}：設定なし|"></span>
																</th:block>
															</li>
														</ul>
													</div>
												</td>
												<td class="align-middle text-left" style="white-space: nowrap;">
													<ul>
														<li th:each="answer,stat2:${question.answerContentLst}">
															<span th:text="|回答${stat2.count}|"></span>
														</li>
													</ul>
												</td>
												<td class="align-middle text-left" style="white-space: nowrap;">
													<a th:onclick="|showimage('contentImg__${stat.index}__')|" class="btn btn-default btn-xs active">
														<img th:id="contentImg__${stat.index}__" th:src="${question.questionImageBase64}" height="40" width="50" th:alt="${question.questionImage}" class="img-thumbnail">
													</a>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</th:block>
		</div>
		<!-- ダイアログのインクルード -->
		<th:block th:replace="/showImgModal.html" />

	</body>
</html>